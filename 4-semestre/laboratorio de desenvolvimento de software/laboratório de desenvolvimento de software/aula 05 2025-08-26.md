# Banco de Dados + Java Swing
---
![[Aula 07 - Banco de dados + Java.pdf]]

Na aula o banco de dados usado foi o MySql nativo, para isso foi usado o **MySQL Command Line Client** 

## Criando Banco de Dados
No MySQL Command Line Client todo o banco de dados é manipulado através de linhas de comando

```sql
show databases;
```
apresentar os bancos de dados

```sql
create database BDAula01;
```
 criar uma base de dados

```sql
use bdaula01;
```
selecionar a base de dados criada

```sql
CREATE TABLE pessoa(
  id int AUTO_INCREMENT PRIMARY KEY,
  nome varchar(50) NOT NULL,
  sexo varchar(1) NOT NULL,
  idioma varchar (10) NOT NULL
  );
```
criar tabela com seus atributos

```sql
desc pessoa;
```
visualizar a tabela

```sql
show tables
```
visualizar todas as tabelas do banco de dados

```sql
INSERT INTO pessoa(nome, sexo, idioma)
    VALUES ("Luiza", "F", "Português");
```
inserir valores na tabela

```sql
select * from pessoa;
```

## Conexão com Banco de Dados
É preciso configurar e programar um projeto para ele se conectar com uma base de dados, para isso deve ser seguido uma sequência de passos.

1) Criar pacote “conexao” com uma classe chamada “Conexao"
2) Abrir a pasta do projeto
3) Dentro da pasta do projeto, criar uma pasta “drivers”
4) Colocar o arquivo de conexão na pasta drivers 
5) Selecionar Add JAR/Folder em "Libraries"
6) Selecionar o arquivo JAR 
7) Programar na classe "Conexao"

```java
package conexao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class Conexao {
    public Connection getConexao(){
        try {
            Connection conn = DriverManager.getConnection(
                    "jdbc:mysql://localhost:3306/bdaula01?useTimeZone=true&serverTimeZone=UTC", "root", "laboratorio");
            System.out.println("Conexao efetuada!");
            return conn;
        } catch (SQLException ex) {
            System.out.println("Erro ao conectar BD: "+ex.getMessage());
            return null;
        }
    }
}
```

8) Instanciar o objeto da classe e chamar o método getConexao (acontece na DAO de cada tabela)

```java
Conexao con = new Conexao();
con.getConexao();
```

## Beans
 O pacote chamado beans, será responsável por conter as classes que representam as tabelas do banco de dados. Cada classe desse pacote terá como atributos as colunas correspondentes de sua tabela, garantindo que haja um _bean_ para cada tabela do sistema. 

Dentro do pacote "beans" criar a classe "Pessoa"

```java
package beans;

public class Pessoa {
    private int id;
    private String nome;
    private String sexo;
    private String idioma;

    public int getId() {
        return id;
    }
    public void setId(int id) {
        this.id = id;
    }
    public String getNome() {
        return nome;
    }
    public void setNome(String nome) {
        this.nome = nome;
    }
    public String getSexo() {
        return sexo;
    }
    public void setSexo(String sexo) {
        this.sexo = sexo;
    }
    public String getIdioma() {
        return idioma;
    }
    public void setIdioma(String idioma) {
        this.idioma = idioma;
    }   
}
```

## DAO
Pacote responsável por armazenar as classes que lidam diretamente com o banco de dados, realizando operações como **inserção, edição, exclusão e pesquisa**. É nesse pacote que estarão os códigos SQL que permitem a persistência das informações. É importante que exista um DAO para cada tabela do sistema.

DAO = _Data Access Object_ – Objeto de Acesso aos Dados

```java
package DAO;

import beans.Pessoa;
import conexao.Conexao;
import java.sql.Connection;
import java.sql.*;

public class PessoaDAO {
    
    private Conexao conexao;
    private Connection conn;
    
    public PessoaDAO(){
        this.conexao = new Conexao();
        this.conn = this.conexao.getConexao();
    }
    
    public void inserir(Pessoa pessoa){
        try {
            String sql = "INSERT INTO pessoa (nome, sexo, idioma)" 
                    + "VALUES (?, ?, ?);";
            
            PreparedStatement stmt = this.conn.prepareStatement(sql);
            stmt.setString(1, pessoa.getNome());
            stmt.setString(2, pessoa.getSexo());
            stmt.setString(3, pessoa.getIdioma());
            stmt.execute();
        } catch (SQLException ex) {
            System.out.println("Erro ao inserir: "+ex.getMessage());
        }
    }
}
```

```java
public class AulaBD {
    public static void main(String[] args) {
        Pessoa p = new Pessoa();
        p.setNome("Luiza");
        p.setSexo("F");
        p.setIdioma("Português");
        
        PessoaDAO pDAO = new PessoaDAO();
        pDAO.inserir(p);
    }
}
```